Xhat = t(factor_RHS)%*%beta
return(list(Xhat,beta))
}
S_CAPM = c("MKT" )
factor_CAPM = factor_all[c(S_CAPM),, drop = FALSE]
dim(factor_LHS)
total_R2_MKT = calc_total_R2(factor_LHS, factor_CAPM)
Xhat_MKT = total_R2_MKT[[1]]
beta_MKT = total_R2_MKT[[2]]
dim(Xhat_MKT)
dim(beta_MKT)
dim(factor_RHS)
total_R2_S = calc_total_R2(factor_LHS, factor_RHS)
Xhat_S = total_R2_S[[1]]
beta_S = total_R2_S[[2]]
dim(Xhat_S)
dim(factor_LHS)
Total_R2 = 1 - sum((factor_LHS - Xhat_S)^2) / sum((factor_LHS - Xhat_MKT)^2)
Total_R2 = Total_R2*100
dim(factor_LHS)
### cross-section
bar_X2 = colMeans(factor_LHS)
dim(bar_X2)
bar_X2
dim(beta)
b = cbind(rep(1,ncol(beta)),t(beta))
gamma = solve(t(b)%*%b)%*%t(b)%*%bar_X2
gamma
dim(beta)
bar_hat = t(beta) %*%gamma[-1]
dim(bar_hat)
calc_CS_R2 = function(factor_LHS, factor_RHS, beta){
### cross-section
bar_X2 = colMeans(factor_LHS)
b = cbind(rep(1,ncol(beta)),t(beta))
gamma = solve(t(b)%*%b)%*%t(b)%*%bar_X2
bar_hat = t(beta) %*%gamma[-1]
return(bar_hat)
}
bar_hat_MKT = calc_CS_R2(factor_LHS, factor_CAPM, beta_MKT)
bar_hat_S = calc_CS_R2(factor_LHS, factor_RHS, beta_S)
bar_factor_LHS = as.matrix(colMeans(factor_LHS))
dim(bar_factor_LHS)
dim(bar_hat_S)
CS_R2 = 1 - sum((bar_factor_LHS - bar_hat_S)^2) / sum((bar_factor_LHS - bar_hat_MKT)^2)
CS_R2
1 - mean((bar_factor_LHS - bar_hat_S)^2) / mean((bar_factor_LHS - bar_hat_MKT)^2)
AP_perform_metric = function(factor_all, factor_LHS,S_factor){
factor_RHS = factor_all[c(S_factor), , drop = FALSE]
Ts = ncol(factor_RHS)
alpha_vector = talpha_vector = NULL
for (i in 1:ncol(factor_LHS)) {
factor_LHSi = factor_LHS[,i, drop = FALSE]
lm1 = lm(factor_LHSi ~ t(factor_RHS))
alphai = summary(lm1)$coefficients[,'Estimate'][1]*100
talphai = summary(lm1)$coefficients[,'t value'][1]
alpha_vector = c(alpha_vector, abs(alphai))
talpha_vector = c(talpha_vector,abs(talphai))
}
Aalpha  = round(mean(alpha_vector),2)
Atalpha = round(mean(talpha_vector),2)
sign2 = length(which(talpha_vector > 1.96))
#### R2
calc_total_R2 = function(factor_LHS, factor_RHS){
Ts = nrow(factor_LHS)
ones = matrix(1,Ts,1)
full_factor_RHS = cbind(ones,t(factor_RHS))
alpha_beta = solve(t(full_factor_RHS)%*%full_factor_RHS)%*%t(full_factor_RHS)%*%factor_LHS
beta = alpha_beta[-1,, drop = FALSE]
Xhat = t(factor_RHS)%*%beta
return(list(Xhat,beta))
}
S_CAPM = c("MKT" )
factor_CAPM = factor_all[c(S_CAPM),, drop = FALSE]
total_R2_MKT = calc_total_R2(factor_LHS, factor_CAPM)
Xhat_MKT = total_R2_MKT[[1]]
beta_MKT = total_R2_MKT[[2]]
total_R2_S = calc_total_R2(factor_LHS, factor_RHS)
Xhat_S = total_R2_S[[1]]
beta_S = total_R2_S[[2]]
Total_R2 = 1 - sum((factor_LHS - Xhat_S)^2) / sum((factor_LHS - Xhat_MKT)^2)
Total_R2 = Total_R2*100
calc_CS_R2 = function(factor_LHS, factor_RHS, beta){
### cross-section
bar_X2 = colMeans(factor_LHS)
b = cbind(rep(1,ncol(beta)),t(beta))
gamma = solve(t(b)%*%b)%*%t(b)%*%bar_X2
bar_hat = t(beta) %*%gamma[-1]
return(bar_hat)
}
bar_hat_MKT = calc_CS_R2(factor_LHS, factor_CAPM, beta_MKT)
bar_hat_S = calc_CS_R2(factor_LHS, factor_RHS, beta_S)
bar_factor_LHS = as.matrix(colMeans(factor_LHS))
CS_R2 = 1 - sum((bar_factor_LHS - bar_hat_S)^2) / sum((bar_factor_LHS - bar_hat_MKT)^2)
CS_R2 = CS_R2*100
return(
c(
round(Aalpha,2),round(Atalpha,2),sign2,
round(Total_R2,1),round(CS_R2,1))
)
}
################## Asset Pricing performance function
R2_all_factor = function(factor_all, model_fin){
AP_perform_metric_result = matrix(,ncol(model_fin),5+1)
for (z in 1:ncol(model_fin)) {
S_factor = na.omit(model_fin[,z])
factor_LHS = factor_all[!rownames(factor_all) %in% c(S_factor),, drop = FALSE]
factor_LHS = t(factor_LHS)
AP_perform_metric_result[z,] = c(length(S_factor), AP_perform_metric(factor_all,factor_LHS,S_factor))
}
return(AP_perform_metric_result)
}
### Asset Pricing (unselected candidate factors)
AP_result_remaining = R2_all_factor(Factor97,model_fin_all)
AP_perform_metric_result = matrix(,ncol(model_fin),5)
dim(test_asset)
test_asset = Fama285
z  = 4
S_factor = na.omit(model_fin[,z])
factor_LHS = test_asset
AP_perform_metric_result[z,] = AP_perform_metric(factor_all,factor_LHS,S_factor)
AP_perform_metric_result
### Asset Pricing (285 basis portfolios)
AP_result_test_asset = R2_all_test_asset(Factor97,Fama285,model_fin_all)
R2_all_test_asset = function(factor_all, test_asset,model_fin){
AP_perform_metric_result = matrix(,ncol(model_fin),5)
for (z in 1:ncol(model_fin)) {
S_factor = na.omit(model_fin[,z])
factor_LHS = test_asset
AP_perform_metric_result[z,] = AP_perform_metric(factor_all,factor_LHS,S_factor)
}
return(AP_perform_metric_result)
}
### Asset Pricing (285 basis portfolios)
AP_result_test_asset = R2_all_test_asset(Factor97,Fama285,model_fin_all)
dim(factor_all)
invest_metric_result = matrix(, ncol(model_fin), 4)
z = 5
S_factor = na.omit(model_fin[,z])
S_factor
dim(factor_all)
factor_RHS = factor_all[c(S_factor),, drop = FALSE]
W_S_factor = cov(t(factor_RHS))
W_S_factor_inv = solve(W_S_factor)
mu_S_factor = matrix(rowMeans(factor_RHS), ncol = 1)
weight_MVE = W_S_factor_inv %*% mu_S_factor
W_S_factor
mu_S_factor
weight_MVE
weight_MVE_adj =  2 * weight_MVE/sum(abs(weight_MVE))
weight_MVE_adj
factor_MVE = t(weight_MVE_adj)%*%factor_RHS
factor_MVE
### metric
AVG = mean(factor_MVE)*100
AVG = round(AVG,2)
AVG
SR = mean(factor_MVE)/sd(factor_MVE)
Ann_SR = sqrt(12)*SR
Ann_SR = round(Ann_SR,2)
Ann_SR
####
S_CAPM = c("MKT" )
factor_CAPM = factor_all[c(S_CAPM),, drop = FALSE]
lm_CAPM = lm(t(factor_MVE) ~ t(factor_CAPM))
alpha_CAPM = summary(lm_CAPM)$coefficients[,'Estimate'][[1]]*100
p_value_CAPM = summary(lm_CAPM)$coefficients[,'Pr(>|t|)'][[1]]
alpha_CAPM_star = paste0(sprintf("%0.2f", alpha_CAPM) , judge.star(p_value_CAPM))
ummary(lm_CAPM)
summary(lm_CAPM)
S_FF5 = c("MKT","SMB","HML","RMW","CMA")
factor_FF5 = factor_all[c(S_FF5),, drop = FALSE]
lm_FF5 = lm(t(factor_MVE) ~ t(factor_FF5))
alpha_FF5 = summary(lm_FF5)$coefficients[,'Estimate'][[1]]*100
p_value_FF5 = summary(lm_FF5)$coefficients[,'Pr(>|t|)'][[1]]
alpha_FF5_star = paste0(sprintf("%0.2f", alpha_FF5) , judge.star(p_value_FF5))
result_metric = c(AVG, Ann_SR,alpha_CAPM_star,alpha_FF5_star)
invest_perform_metric = function(factor_all,S_factor){
factor_RHS = factor_all[c(S_factor),, drop = FALSE]
if (length(S_factor) == 1){
factor_MVE = factor_RHS
} else {
W_S_factor = cov(t(factor_RHS))
W_S_factor_inv = solve(W_S_factor)
mu_S_factor = matrix(rowMeans(factor_RHS), ncol = 1)
weight_MVE = W_S_factor_inv %*% mu_S_factor
weight_MVE_adj =  2 * weight_MVE/sum(abs(weight_MVE))
factor_MVE = t(weight_MVE_adj)%*%factor_RHS
}
### metric
AVG = mean(factor_MVE)*100
AVG = round(AVG,2)
SR = mean(factor_MVE)/sd(factor_MVE)
Ann_SR = sqrt(12)*SR
Ann_SR = round(Ann_SR,2)
####
S_CAPM = c("MKT" )
factor_CAPM = factor_all[c(S_CAPM),, drop = FALSE]
lm_CAPM = lm(t(factor_MVE) ~ t(factor_CAPM))
alpha_CAPM = summary(lm_CAPM)$coefficients[,'Estimate'][[1]]*100
p_value_CAPM = summary(lm_CAPM)$coefficients[,'Pr(>|t|)'][[1]]
alpha_CAPM_star = paste0(sprintf("%0.2f", alpha_CAPM) , judge.star(p_value_CAPM))
S_FF5 = c("MKT","SMB","HML","RMW","CMA")
factor_FF5 = factor_all[c(S_FF5),, drop = FALSE]
lm_FF5 = lm(t(factor_MVE) ~ t(factor_FF5))
alpha_FF5 = summary(lm_FF5)$coefficients[,'Estimate'][[1]]*100
p_value_FF5 = summary(lm_FF5)$coefficients[,'Pr(>|t|)'][[1]]
alpha_FF5_star = paste0(sprintf("%0.2f", alpha_FF5) , judge.star(p_value_FF5))
result_metric = c(AVG, Ann_SR,alpha_CAPM_star,alpha_FF5_star)
return(result_metric)
}
##### Investment performance
invest_result_all = investing_asset(Factor97,model_fin_all)
result_all = cbind(AP_result_remaining,AP_result_test_asset,invest_result_all)
colnames(result_all) = c('#M',
'Aalpha','Atalpha','sign2',
'Total_R2','CS_R2',
'Aalpha','Atalpha','sign2',
'Total_R2','CS_R2',
"AVG","Ann.SR",'alpha_CAPM',"alpha_FF5")
rownames(result_all) = c(
'CAPM','FF3', 'FF5','FF6', 'Q5','DHS3','BS6',
'CAPM$^F$','FF3$^F$', 'FF5$^F$','FF6$^F$', 'Q5$^F$','DHS3$^F$','BS6$^F$','M8')
write.csv(result_all,'Table3/Table3.csv')
folder_name <- "Figure1"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
source('../fun_Section.R')
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
Fama285 = read.csv('../data/Fama285.csv')
Fama285 = as.matrix(Fama285[,-c(1,2)])
S_CAPM = c("MKT")
S_FF3 = c("MKT","SMB","HML")
S_FF5 = c("MKT","SMB","HML","RMW","CMA" )
S_FF6 = c(S_FF5,'UMD' )
S_Q5 = c("MKT","SMB","IA", "ROE" , "REG" )
S_DHS3 = c('MKT', "PEAD", "FIN")
S_BS6 =  c("MKT","SMB","IA", "ROE" , 'UMD',"HMLM" )
model_fin_all = read.csv('./Table1/Model_fin_all.csv')
model_fin_all = model_fin_all[,-1]
model_fin_all_FSE = model_fin_all[,8:14]
model_fin = list(S_CAPM,S_FF3, S_FF5,S_FF6, S_Q5,S_DHS3,S_BS6)
model_FSE = matrix(,nrow(model_fin_all_FSE),ncol(model_fin_all_FSE))
factor_model = c('CAPM','FF3','FF5','FF6','Q5','DHS3','BS6')
factor_model
i = 1
model_fin_all_FSE1 = na.omit(model_fin_all_FSE[,i])
model_fin_all_FSE1
model_fin_all_FSE
model_fin_all_FSE1 = na.omit(model_fin_all_FSE[,i])
unlist(model_fin[i])
model2 = setdiff(model_fin_all_FSE1, unlist(model_fin[i]))
model2
model_FSE[1:(length(model2)+1),i] = c(factor_model[i],model2)
factor_model = c('CAPM','FF3','FF5','FF6','Q5','DHS3','BS6')
for (i in 1:length(model_fin)) {
model_fin_all_FSE1 = na.omit(model_fin_all_FSE[,i])
model2 = setdiff(model_fin_all_FSE1, unlist(model_fin[i]))
model_FSE[1:(length(model2)+1),i] = c(factor_model[i],model2)
}
model_FSE <- model_FSE[!apply(is.na(model_FSE), 1, all), ]
model_FSE
GRS_FSE = matrix(,nrow(model_FSE),ncol(model_FSE))
SR_FSE = matrix(,nrow(model_FSE),ncol(model_FSE))
HDA_FSE = matrix(,nrow(model_FSE),ncol(model_FSE))
model_fin
m = 1
model_fin_all_FSE1 = na.omit(model_fin_all_FSE[,m])
model2 = setdiff(model_fin_all_FSE1, unlist(model_fin[m]))
model_fin_all_FSE1
model2
m
m = 3
model_fin_all_FSE1 = na.omit(model_fin_all_FSE[,m])
model2 = setdiff(model_fin_all_FSE1, unlist(model_fin[m]))
model_fin_all_FSE1
model2
j =
1
Sj = model_fin_all_FSE1[1:(length(unlist(model_fin[m])) + j -1)]
Sj
factor_RHS = Factor97[c(Sj), , drop = FALSE]
factor_LHS = Factor97[!rownames(Factor97) %in% c(Sj),, drop = FALSE]
factor_LHS
F1 = t(factor_RHS)
F2 = t(factor_LHS)
result1 = GRS_test(F1, F2)
result2 = HDA_test(F1, F2)
result1 = GRS_test(F1, F2)
result2 = HDA_test(F1, F2)
GRS_FSE[j,m] = result1[[2]]
HDA_FSE[j,m] = judge.star_HDA(result2[[1]])
## SR
SR = sqrt(calc_Max_SR2(F1))
SR = SR*sqrt(12)
SR_FSE[j,m] = SR
SR
i =1
j = 2
Sj = model_fin_all_FSE1[1:(length(unlist(model_fin[m])) + j -1)]
Sj
factor_RHS = Factor97[c(Sj), , drop = FALSE]
factor_LHS = Factor97[!rownames(Factor97) %in% c(Sj),, drop = FALSE]
F1 = t(factor_RHS)
F2 = t(factor_LHS)
result1 = GRS_test(F1, F2)
result2 = HDA_test(F1, F2)
GRS_FSE[j,m] = result1[[2]]
HDA_FSE[j,m] = judge.star_HDA(result2[[1]])
## SR
SR = sqrt(calc_Max_SR2(F1))
SR = SR*sqrt(12)
SR_FSE[j,m] = SR
SR
GRS_FSE = matrix(,nrow(model_FSE),ncol(model_FSE))
SR_FSE = matrix(,nrow(model_FSE),ncol(model_FSE))
HDA_FSE = matrix(,nrow(model_FSE),ncol(model_FSE))
for (m in 1:length(model_fin)) {
model_fin_all_FSE1 = na.omit(model_fin_all_FSE[,m])
model2 = setdiff(model_fin_all_FSE1, unlist(model_fin[m]))
for (j in 1:(length(model2)+1)) {
Sj = model_fin_all_FSE1[1:(length(unlist(model_fin[m])) + j -1)]
factor_RHS = Factor97[c(Sj), , drop = FALSE]
factor_LHS = Factor97[!rownames(Factor97) %in% c(Sj),, drop = FALSE]
F1 = t(factor_RHS)
F2 = t(factor_LHS)
result1 = GRS_test(F1, F2)
result2 = HDA_test(F1, F2)
GRS_FSE[j,m] = result1[[2]]
HDA_FSE[j,m] = judge.star_HDA(result2[[1]])
## SR
SR = sqrt(calc_Max_SR2(F1))
SR = SR*sqrt(12)
SR_FSE[j,m] = SR
}
}
colnames(model_FSE) = colnames(GRS_FSE) = colnames(SR_FSE) =
colnames(HDA_FSE)  = c('CAPM','FF3', 'FF5', 'FF6','Q5', 'DHS3','BS6')
write.csv(model_FSE, 'Figure1/Figure1_model_FSE.csv')
write.csv(GRS_FSE, 'Figure1/Figure1_GRS_FSE.csv')
write.csv(SR_FSE, 'Figure1/Figure1_SR_FSE.csv')
write.csv(HDA_FSE, 'Figure1/Figure1_HDA_FSE.csv')
folder_name <- "Figure2"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
source('../fun_Section.R')
Fama285 = read.csv('../data/Fama285.csv')
Fama285 = as.matrix(Fama285[,-c(1,2)])
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
Fama285 = read.csv('../data/Fama285.csv')
Fama285 = as.matrix(Fama285[,-c(1,2)])
bench_factor = c('MKT', 'SMB', 'HML')
lambda = 0.05
factor_all = Factor97
bench_num = length(bench_factor)
if (is.null(bench_factor)){
print('Starting from an empty model')
}
S =  bench_factor
Ts = ncol(factor_all)
Ns = nrow(factor_all)
names_all = rownames(factor_all)
k_forward = Ns - 1 - bench_num
## step 0
GRS_all = SR_all = NULL
factor_RHS = factor_all[c(S), , drop = FALSE]
factor_LHS = factor_all[!rownames(factor_all) %in% c(S),, drop = FALSE]
F1 = t(factor_RHS)
F2 = t(factor_LHS)
GRS_all = GRS_test(F1, F2)[[2]]
SR_all = sqrt(calc_Max_SR2(t(factor_RHS)))*sqrt(12)
k_forward = Ns - 1 - bench_num
## step 0
GRS_all = SR_all = NULL
factor_RHS = factor_all[c(S), , drop = FALSE]
factor_LHS = factor_all[!rownames(factor_all) %in% c(S),, drop = FALSE]
F1 = t(factor_RHS)
F2 = t(factor_LHS)
GRS_all = GRS_test(F1, F2)[[2]]
SR_all = sqrt(calc_Max_SR2(t(factor_RHS)))*sqrt(12)
FSE_stage_bench_figure = function(factor_all, lambda, bench_factor){
bench_num = length(bench_factor)
if (is.null(bench_factor)){
print('Starting from an empty model')
}
S =  bench_factor
Ts = ncol(factor_all)
Ns = nrow(factor_all)
names_all = rownames(factor_all)
k_forward = Ns - 1 - bench_num
## step 0
GRS_all = SR_all = NULL
factor_RHS = factor_all[c(S), , drop = FALSE]
factor_LHS = factor_all[!rownames(factor_all) %in% c(S),, drop = FALSE]
F1 = t(factor_RHS)
F2 = t(factor_LHS)
GRS_all = GRS_test(F1, F2)[[2]]
SR_all = sqrt(calc_Max_SR2(t(factor_RHS)))*sqrt(12)
for (i in 1:k_forward) {
Ns_i = Ns - length(S)
names_all_i = setdiff(names_all, S)
Max_SR2i = NULL
for (j in 1:Ns_i) {
Sj = union(x = names_all_i[j], y = S)
factor_RHS = factor_all[c(Sj), , drop = FALSE]
# Max SR2
W_Sj = cov(t(factor_RHS))
W_Sj_inv = solve(W_Sj)
mu_Sj = matrix(rowMeans(factor_RHS), ncol = 1)
Max_SR2_Sj = t(mu_Sj) %*% W_Sj_inv %*% mu_Sj
Max_SR2i = c(Max_SR2i, Max_SR2_Sj)
}
a_i = names_all_i[which(Max_SR2i == max(Max_SR2i))]
S = c(S, a_i)
factor_RHS = factor_all[c(S), , drop = FALSE]
factor_LHS = factor_all[!rownames(factor_all) %in% c(S),, drop = FALSE]
F1 = t(factor_RHS)
F2 = t(factor_LHS)
GRS_alli = GRS_test(F1, F2)[[2]]
GRS_all = c(GRS_all,GRS_alli)
SR_alli = sqrt(calc_Max_SR2(F1))*sqrt(12)
SR_all = c(SR_all,SR_alli)
# if (p_HDAi > lambda) {
#   break;
# }
}
S_FSE = S
return(list(S_FSE,GRS_all,SR_all))
}
BSE_stage_bench_figure = function(factor_all, lambda, bench_factor_BSE){
bench_num = length(bench_factor_BSE)
S =  bench_factor_BSE
Ts = ncol(factor_all)
Ns = nrow(factor_all)
names_all = rownames(factor_all)
k_backward = bench_num - 1
BSE_Path = NULL
GRS_all = SR_all = NULL
factor_RHS = factor_all[c(S), , drop = FALSE]
factor_LHS = factor_all[!rownames(factor_all) %in% c(S),, drop = FALSE]
F1 = t(factor_RHS)
F2 = t(factor_LHS)
GRS_all = GRS_test(F1, F2)[[2]]
SR_all = sqrt(calc_Max_SR2(t(factor_RHS)))*sqrt(12)
for (i in 1:k_backward) {
Ns_i = length(S)
S_BSE = S
Max_SR2i = NULL
for (j in 1:Ns_i) {
Sj = setdiff(S, S[j])
factor_RHS = factor_all[c(Sj), , drop = FALSE]
# Max SR2
W_Sj = cov(t(factor_RHS))
W_Sj_inv = solve(W_Sj)
mu_Sj = matrix(rowMeans(factor_RHS), ncol = 1)
Max_SR2_Sj = t(mu_Sj) %*% W_Sj_inv %*% mu_Sj
Max_SR2i = c(Max_SR2i, Max_SR2_Sj)
}
b_i = S[which(Max_SR2i == max(Max_SR2i))]
S = setdiff(S, b_i)
BSE_Path = c(BSE_Path, b_i)
factor_RHS = factor_all[c(S), , drop = FALSE]
factor_LHS = factor_all[!rownames(factor_all) %in% c(S),, drop = FALSE]
F1 = t(factor_RHS)
F2 = t(factor_LHS)
GRS_alli = GRS_test(F1, F2)[[2]]
GRS_all = c(GRS_all,GRS_alli)
SR_alli = sqrt(calc_Max_SR2(F1))*sqrt(12)
SR_all = c(SR_all,SR_alli)
}
S_BSE = S_BSE
return(list(BSE_Path,GRS_all,SR_all))
}
result_FF3_FSE = FSE_stage_bench_figure(Factor97, lambda = 0.05, bench_factor)
Factor_FSE =  result_FF3_FSE[[1]]
GRS = result_FF3_FSE[[2]]
Ann.SR = result_FF3_FSE[[3]]
Factor_FSE
model_fin1 = Factor_FSE[-c(1:3)]
m = seq(0, length(names97)-length(bench_factor),1)
GRS = c(GRS,0)
Ann.SR = c(Ann.SR, sqrt(calc_Max_SR2(t(Factor97)))*sqrt(12))
data = data.frame(cbind(m,GRS, Ann.SR))
colnames(data) = c("m","GRS","Ann.SR")
rownames(data) = c('FF3', Factor_FSE[-c(1:3)],setdiff(names97, Factor_FSE))
write.csv(data, 'Figure2/Figure2.csv')
output_path <- "Table4"
if (!dir.exists(output_path)) {
dir.create(output_path)
}
model_fin_all = read.csv('../Section4/Table1/Model_fin_all.csv')
model_fin_all = model_fin_all[,-1]
model_fin_FSE = model_fin_all[,c(8:14)]
model_fin_BSE = model_fin_all[,c(15:21)]
model_fin_BSE = as.matrix(na.omit(model_fin_BSE))
model_fin_num = matrix(,3,ncol(model_fin_BSE))
for (m in 1:ncol(model_fin_BSE)) {
FSE_factor = na.omit(model_fin_FSE[,m])
BSE_factor = na.omit(model_fin_BSE[,m])
removed_factor = setdiff(FSE_factor,BSE_factor)
model_fin_num[,m] = c(length(FSE_factor),length(BSE_factor),length(removed_factor))
}
model_fin_BSE_report = rbind(model_fin_BSE,model_fin_num)
colnames(model_fin_BSE_report) =  c('CAPM$^{F+B}$','FF3$^{F+B}$','FF5$^{F+B}$','FF6$^{F+B}$','Q5$^{F+B}$','DHS3$^{F+B}$','BS6$^{F+B}$')
rownames(model_fin_BSE_report) = c(seq(1,8,1),'# M$^F$', '# M^{F+B}','# Removed')
write.csv(model_fin_BSE_report,'Table4/Table4.csv')
