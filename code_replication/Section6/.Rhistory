'FGX2020', 'KNS2020', 'FGX2020$^{F+B}$', 'KNS2020$^{F+B}$')
result_all  = t(result_all)
write.csv(result_all,'Table9/Table9.csv')
source('../fun_Section.R')
folder_name = "Table6"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
names97_MKT = names97[-1]
result97_MKT = matrix(,length(names97_MKT), length(names97_MKT))
for (s in 1:length(names97_MKT)) {
bench_factor = c('MKT',names97_MKT[s])
S_FSE = FSE_stage_bench(Factor97, lambda = 0.05, bench_factor)
bench_factor_BSE = S_FSE
S_BSE = BSE_stage_bench(Factor97, lambda = 0.05, bench_factor_BSE)
result97_MKT[1:length(S_BSE),s] = S_BSE
}
colnames(result97_MKT) = names97_MKT
bench_factor = c('MKT')
S_FSE = FSE_stage_bench(Factor97, lambda = 0.05, bench_factor)
M8 =  BSE_stage_bench(Factor97, lambda = 0.05, S_FSE)
result97_MKT
M8
result_all97_MKT = matrix(,nrow(Factor97), 3)
result_all97_1_MKT  = matrix(0,nrow(Factor97), ncol(result97_MKT ))
result_all97_MKT
dim(result_all97_1_MKT)
for (i in 1:ncol(result97_MKT)) {
result97_MKTi = result97_MKT[,i]
result97_MKTi = result97_MKTi[!is.na(result97_MKTi)]
result_all97_MKT[i+1,1] <- as.numeric(length(intersect(result97_MKTi, names97[i+1])) > 0)
result_all97_MKT[i+1,2] = as.numeric(identical(sort(result97_MKTi), sort(M8)))
result_all97_1_MKT[c(which(names97 %in% result97_MKTi)),i] = 1
}
View(result_all97_1_MKT)
result_all97_MKT[,3] = round(rowMeans(result_all97_1_MKT),2)
result_all97_MKT
rownames(result_all97_MKT) = names97
rownames(result_all97_MKT) = names97
result_all97_MKT = cbind(seq(1,length(names97),1),result_all97_MKT)
colnames(result_all97_MKT) = c('ID','Selected','Same','Rate')
write.csv(result_all97_MKT,'Table6/Table6.csv')
source('../fun_Section.R')
folder_name = "Table7"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
names97_FF3 = names97[-c(1:3)]
result97_FF3 = matrix(,length(names97_FF3), length(names97_FF3))
for (s in 1:length(names97_FF3)) {
bench_factor = c('MKT','SMB','HML',names97_FF3[s])
S_FSE = FSE_stage_bench(Factor97, lambda = 0.05, bench_factor)
bench_factor_BSE = S_FSE
S_BSE = BSE_stage_bench(Factor97, lambda = 0.05, bench_factor_BSE)
result97_FF3[1:length(S_BSE),s] = S_BSE
}
colnames(result97_FF3) = names97_FF3
bench_factor = c('MKT')
S_FSE = FSE_stage_bench(Factor97, lambda = 0.05,bench_factor)
M8 =  BSE_stage_bench(Factor97, lambda = 0.05,S_FSE)
result_all97_FF3 = matrix(,nrow(Factor97), 3)
result_all97_1_FF3  = matrix(0,nrow(Factor97), ncol(result97_FF3 ))
for (i in 1:ncol(result97_FF3)) {
result97_FF3i = result97_FF3[,i]
result97_FF3i = result97_FF3i[!is.na(result97_FF3i)]
result_all97_FF3[i+3, 1] <- as.numeric(length(intersect(result97_FF3i, names97[i+3])) > 0)
result_all97_FF3[i+3,2] = as.numeric(identical(sort(result97_FF3i), sort(M8)))
result_all97_1_FF3[c(which(names97 %in% result97_FF3i)),i] = 1
}
result_all97_FF3[,3] = round(rowMeans(result_all97_1_FF3),2)
round(rowMeans(result_all97_1_FF3),2)
rownames(result_all97_FF3) = names97
result_all97_FF3 = cbind(seq(1,length(names97),1),result_all97_FF3)
colnames(result_all97_FF3) = c('ID','Selected','Same','Rate')
write.csv(result_all97_FF3,'Table7/Table7.csv')
source('../fun_Section.R')
folder_name = "Table8"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
Fama285 = read.csv('../data/Fama285.csv')
Fama285 = as.matrix(Fama285[,-c(1,2)])
Factor_RPPCA5 = read.csv('../data/RP-PCA/RPPCA_Factor.csv')
Factor_RPPCA5 = as.matrix(t(Factor_RPPCA5))
Factor_RRA5 = read.csv('../data/RRA/RRA_Factor.csv')
Factor_RRA5 = as.matrix(t(Factor_RRA5))
View(Factor_RPPCA5)
S_RRA5 = c('RRA1','RRA2','RRA3','RRA4','RRA5')
S_RPPCA5 = c('RPCA1','RPCA2','RPCA3','RPCA4','RPCA5')
S_KNS2020 = c("MKT", "SMB","BAB","ROE","ABR","CIM","dROE")
S_FGX2020 = c("MKT","UMD","BAB","CIM","R5A")
model_fin = list(S_RPPCA5,S_RRA5,S_FGX2020,S_KNS2020)
model_names = c('RPPCA','RRA','FGX2020','KNS2020')
dim(Factor_RPPCA5)
dim(Factor97)
model_fin_BSE =  list()
for (m in 1:length(model_names)) {
if (model_names[m] == 'RPPCA'){
factor_all = rbind(Factor97,Factor_RPPCA5)
} else if (model_names[m] == 'RRA'){
factor_all = rbind(Factor97,Factor_RRA5)
} else {
factor_all = Factor97
}
bench_factor = unlist(model_fin[m])
S_FSE = FSE_stage_bench(factor_all, lambda = 0.05,bench_factor)
S_BSE = BSE_stage_bench(factor_all, lambda = 0.05, S_FSE)
model_fin_BSE[[m]] = S_BSE
}
merged_list <- c(model_fin, model_fin_BSE)
merged_list
max_length <- max(lengths(merged_list))
max_length
merged_list <- c(model_fin, model_fin_BSE)
max_length <- max(lengths(merged_list))
model_fin_all <- do.call(cbind, lapply(merged_list, function(x) c(x, rep(NA, max_length - length(x)))))
model_fin_all = model_fin_all[,c(1:2, 5:6 ,3:4, 7:8)]
model_fin_all <- do.call(cbind, lapply(merged_list, function(x) c(x, rep(NA, max_length - length(x)))))
model_fin_all
model_fin_all = model_fin_all[,c(1:2, 5:6 ,3:4, 7:8)]
colnames(model_fin_all) =  c('RP-PCA','RRA','RP-PCA$^{F+B}$','RRA$^{F+B}$',
'FGX2020','KNS2020','FGX2020$^{F+B}$','KNS2020$^{F+B}$')
write.csv(model_fin_all,'Table8/Table8.csv')
source('../fun_Section.R')
folder_name = "Table9"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
Fama285 = read.csv('../data/Fama285.csv')
Fama285 = as.matrix(Fama285[,-c(1,2)])
Factor_RPPCA5 = read.csv('../data/RP-PCA/RPPCA_Factor.csv')
Factor_RPPCA5 = as.matrix(t(Factor_RPPCA5))
Factor_RRA5 = read.csv('../data/RRA/RRA_Factor.csv')
Factor_RRA5 = as.matrix(t(Factor_RRA5))
model_fin_all = read.csv('Table8/Table8.csv')
View(model_fin_all)
model_fin_all = model_fin_all[,c(-1)]
model_names = c('RPPCA','RRA','RPPCA','RRA','FGX2020','KNS2020','FGX2020','KNS2020')
ncol(model_fin_all)
### Asset Pricing (unselected candidate factors)
R2_all_factor = function(factor_all,model_fin){
AP_perform_metric_result = matrix(,ncol(model_fin),1+5)
for (z in 1:ncol(model_fin)) {
if (model_names[z] == 'RPPCA'){
factor_all = rbind(Factor97,Factor_RPPCA5)
} else if (model_names[z] == 'RRA'){
factor_all = rbind(Factor97,Factor_RRA5)
} else {
factor_all = Factor97
}
S_factor = na.omit(model_fin[,z])
factor_LHS = factor_all[!rownames(factor_all) %in% c(S_factor),, drop = FALSE]
factor_LHS = t(factor_LHS)
AP_perform_metric_result[z,] = c(length(S_factor), AP_perform_metric(factor_all,factor_LHS,S_factor) )
}
return(AP_perform_metric_result)
}
AP_result_remaining = R2_all_factor(Factor97,model_fin_all)
AP_result_remaining
model_names[z]
z  = 1
AP_perform_metric_result = matrix(,ncol(model_fin),1+5)
model_fin = model_fin_all
(model_names[z] == 'RPPCA')
factor_all = rbind(Factor97,Factor_RPPCA5)
S_factor = na.omit(model_fin[,z])
factor_LHS = factor_all[!rownames(factor_all) %in% c(S_factor),, drop = FALSE]
factor_LHS = t(factor_LHS)
AP_perform_metric_result[z,] = c(length(S_factor), AP_perform_metric(factor_all,factor_LHS,S_factor) )
AP_perform_metric_result = matrix(,ncol(model_fin),1+5)
c(length(S_factor), AP_perform_metric(factor_all,factor_LHS,S_factor) )
### Asset Pricing (unselected candidate factors)
R2_all_factor_new = function(factor_all,model_fin){
AP_perform_metric_result = matrix(,ncol(model_fin),1+5)
for (z in 1:ncol(model_fin)) {
if (model_names[z] == 'RPPCA'){
factor_all = rbind(Factor97,Factor_RPPCA5)
} else if (model_names[z] == 'RRA'){
factor_all = rbind(Factor97,Factor_RRA5)
} else {
factor_all = Factor97
}
S_factor = na.omit(model_fin[,z])
factor_LHS = factor_all[!rownames(factor_all) %in% c(S_factor),, drop = FALSE]
factor_LHS = t(factor_LHS)
AP_perform_metric_result[z,] = c(length(S_factor), AP_perform_metric(factor_all,factor_LHS,S_factor) )
}
return(AP_perform_metric_result)
}
AP_result_remaining = R2_all_factor_new(Factor97,model_fin_all)
AP_result_remaining
source('../fun_Section.R')
folder_name = "Table9"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
Fama285 = read.csv('../data/Fama285.csv')
Fama285 = as.matrix(Fama285[,-c(1,2)])
Factor_RPPCA5 = read.csv('../data/RP-PCA/RPPCA_Factor.csv')
Factor_RPPCA5 = as.matrix(t(Factor_RPPCA5))
Factor_RRA5 = read.csv('../data/RRA/RRA_Factor.csv')
Factor_RRA5 = as.matrix(t(Factor_RRA5))
model_fin_all = read.csv('Table8/Table8.csv')
model_fin_all = model_fin_all[,c(-1)]
model_names = c('RPPCA','RRA','RPPCA','RRA','FGX2020','KNS2020','FGX2020','KNS2020')
AP_result_remaining = R2_all_factor_new(model_fin_all)
AP_result_remaining
R2_all_factor_new = function(Factor97,Factor_RPPCA5,Factor_RRA5,model_fin){
AP_perform_metric_result = matrix(,ncol(model_fin),1+5)
for (z in 1:ncol(model_fin)) {
if (model_names[z] == 'RPPCA'){
factor_all = rbind(Factor97,Factor_RPPCA5)
} else if (model_names[z] == 'RRA'){
factor_all = rbind(Factor97,Factor_RRA5)
} else {
factor_all = Factor97
}
S_factor = na.omit(model_fin[,z])
factor_LHS = factor_all[!rownames(factor_all) %in% c(S_factor),, drop = FALSE]
factor_LHS = t(factor_LHS)
AP_perform_metric_result[z,] = c(length(S_factor), AP_perform_metric(factor_all,factor_LHS,S_factor) )
}
return(AP_perform_metric_result)
}
AP_result_remaining = R2_all_factor_new(model_fin_all)
AP_result_remaining = R2_all_factor_new(Factor97,Factor_RPPCA5,Factor_RRA5,model_fin)
AP_result_remaining = R2_all_factor_new(Factor97,Factor_RPPCA5,Factor_RRA5,model_fin_all)
AP_result_remaining
dim(factor_all)
z =1
if (model_names[z] == 'RPPCA'){
factor_all = rbind(Factor97,Factor_RPPCA5)
} else if (model_names[z] == 'RRA'){
factor_all = rbind(Factor97,Factor_RRA5)
} else {
factor_all = Factor97
}
dim(factor_all)
S_factor = na.omit(model_fin[,z])
model_fin = model_fin_f
model_fin= model_fin_fin
model_fin= model_fin_all
z
S_factor = na.omit(model_fin[,z])
S_factor
factor_LHS = factor_all[!rownames(factor_all) %in% c(S_factor),, drop = FALSE]
factor_LHS = t(factor_LHS)
View(factor_LHS)
dim(factor_all)
dim(factor_LHS)
R2_all_test_asset_new = function(Factor97,Factor_RPPCA5,Factor_RRA5,test_asset,model_fin){
AP_perform_metric_result = matrix(,ncol(model_fin),5)
for (z in 1:ncol(model_fin)) {
if (model_names[z] == 'RPPCA'){
factor_all = rbind(Factor97,Factor_RPPCA5)
} else if (model_names[z] == 'RRA'){
factor_all = rbind(Factor97,Factor_RRA5)
} else {
factor_all = Factor97
}
S_factor = na.omit(model_fin[,z])
factor_LHS = test_asset
AP_perform_metric_result[z,] = AP_perform_metric(factor_all,factor_LHS,S_factor)
}
return(AP_perform_metric_result)
}
AP_result_test_asset = R2_all_test_asset(Factor97,Factor_RPPCA5,Factor_RRA5, Fama285,model_fin_all)
AP_result_test_asset = R2_all_test_asset_new(Factor97,Factor_RPPCA5,Factor_RRA5, Fama285,model_fin_all)
AP_result_test_asset
investing_asset_new = function(Factor97,Factor_RPPCA5,Factor_RRA5,model_fin){
invest_metric_result = matrix(, ncol(model_fin), 4)
for (z in 1:ncol(model_fin)) {
if (model_names[z] == 'RPPCA'){
factor_all = rbind(Factor97,Factor_RPPCA5)
} else if (model_names[z] == 'RRA'){
factor_all = rbind(Factor97,Factor_RRA5)
} else {
factor_all = Factor97
}
S_factor = na.omit(model_fin[,z])
invest_metric_result[z,] = invest_perform_metric(factor_all,S_factor)
}
return(invest_metric_result)
}
### investing performance
invest_result_all = investing_asset_new(Factor97,Factor_RPPCA5,Factor_RRA5,model_fin_all)
invest_result_all
result_all = cbind(AP_result_remaining,AP_result_test_asset,invest_result_all)
colnames(result_all) = c('#Factor',
'Aalpha','Atalpha','sign2',
'Total_R2','CS_R2',
'Aalpha','Atalpha','sign2',
'Total_R2','CS_R2',
"AVG","Ann.SR",'alpha_CAPM',"alpha_FF5")
rownames(result_all) = c(
'RP-PCA','RRA','RP-PCA$^{F+B}$','RRA$^{F+B}$',
'FGX2020', 'KNS2020', 'FGX2020$^{F+B}$', 'KNS2020$^{F+B}$')
result_all  = t(result_all)
result_all
write.csv(result_all,'Table9/Table9.csv')
source('../fun_Section.R')
folder_name = "Table9"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
Fama285 = read.csv('../data/Fama285.csv')
Fama285 = as.matrix(Fama285[,-c(1,2)])
Factor_RPPCA5 = read.csv('../data/RP-PCA/RPPCA_Factor.csv')
Factor_RPPCA5 = as.matrix(t(Factor_RPPCA5))
Factor_RRA5 = read.csv('../data/RRA/RRA_Factor.csv')
Factor_RRA5 = as.matrix(t(Factor_RRA5))
model_fin_all = read.csv('Table8/Table8.csv')
model_fin_all = model_fin_all[,c(-1)]
model_names = c('RPPCA','RRA','RPPCA','RRA','FGX2020','KNS2020','FGX2020','KNS2020')
### Asset Pricing (unselected candidate factors)
AP_result_remaining = R2_all_factor_new(Factor97,Factor_RPPCA5,Factor_RRA5,model_fin_all)
### Asset Pricing (285 basis portfolios)
AP_result_test_asset = R2_all_test_asset_new(Factor97,Factor_RPPCA5,Factor_RRA5, Fama285,model_fin_all)
### investing performance
invest_result_all = investing_asset_new(Factor97,Factor_RPPCA5,Factor_RRA5,model_fin_all)
result_all = cbind(AP_result_remaining,AP_result_test_asset,invest_result_all)
colnames(result_all) = c('#Factor',
'Aalpha','Atalpha','sign2',
'Total_R2','CS_R2',
'Aalpha','Atalpha','sign2',
'Total_R2','CS_R2',
"AVG","Ann.SR",'alpha_CAPM',"alpha_FF5")
rownames(result_all) = c(
'RP-PCA','RRA','RP-PCA$^{F+B}$','RRA$^{F+B}$',
'FGX2020', 'KNS2020', 'FGX2020$^{F+B}$', 'KNS2020$^{F+B}$')
result_all  = t(result_all)
write.csv(result_all,'Table9/Table9.csv')
source('../fun_Section.R')
folder_name = "Table10"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
Fama285 = read.csv('../data/Fama285.csv')
Fama285 = as.matrix(Fama285[,-c(1,2)])
Factor_RPPCA5 = read.csv('../data/RP-PCA/RPPCA_Factor.csv')
Factor_RPPCA5 = as.matrix(t(Factor_RPPCA5))
Factor_RRA5 = read.csv('../data/RRA/RRA_Factor.csv')
Factor_RRA5 = as.matrix(t(Factor_RRA5))
Factor_all = rbind(Factor97,Factor_RPPCA5,Factor_RRA5)
names_all = rownames(Factor_all)
###### all model
S_CAPM = c("MKT")
S_FF3 = c("MKT","SMB","HML")
S_FF5 = c("MKT","SMB","HML","RMW","CMA" )
S_FF6 = c(S_FF5,'UMD' )
S_Q5 = c("MKT","SMB","IA", "ROE" , "REG" )
S_DHS3 = c('MKT', "PEAD", "FIN")
S_BS6 =  c("MKT","SMB","IA", "ROE" , 'UMD',"HMLM" )
S_M8 = c('MKT','SMB','REG','PEAD','HMLM','STR','ILR','EPRD')
S_RPPCA5 = c('RPCA1','RPCA2','RPCA3','RPCA4','RPCA5')
S_RRA5 =  c('RRA1','RRA2','RRA3','RRA4','RRA5')
S_FGX2020 = c('MKT','UMD','BAB','CIM','R5A')
S_KNS2020 = c('MKT','SMB','BAB','ROE','ABR', 'CIM','dROE')
model_fin =list(S_CAPM,S_FF3, S_FF5,S_RRA5,S_FF6,S_FGX2020, S_KNS2020,S_RPPCA5,S_BS6, S_DHS3,S_Q5,
S_M8)
model_all_names = c('CAPM','FF3', 'FF5','RRA','FF6','FGX2020','KNS2020','RP-PCA','BS6','DHS3', 'Q5','M8')
M <- 1000
### sample data
T1 = ncol(Factor_all)
N1 = nrow(Factor_all)
nMonths = T1
halfN <- nMonths / 2
model_SR_in = model_SR_out = matrix(,M,length(model_all_names))
colnames(model_SR_in) =  colnames(model_SR_out) = model_all_names
set.seed(2025)
pairStartMonths <- seq(from = 1, to = nMonths, by = 2)
randomBinaryInd <- matrix(sample(0:1, halfN * M, replace = TRUE),
nrow = halfN, ncol = M)
randomPairsIndicator <- matrix(sample(halfN, halfN * M, replace = TRUE),
nrow = halfN, ncol = M)
inSampleInd  <- matrix(nrow = halfN, ncol = M)
outSampleInd <- matrix(nrow = halfN, ncol = M)
for (m in 1:M) {
isMonths  <- pairStartMonths + randomBinaryInd[, m]
oosMonths <- pairStartMonths + 1 - randomBinaryInd[, m]
inSampleInd[, m]  <- isMonths[randomPairsIndicator[, m]]
outSampleInd[, m] <- oosMonths[randomPairsIndicator[, m]]
Factor_all_in = as.matrix(Factor_all[,c(isMonths)])
Factor_all_out = as.matrix(Factor_all[,c(oosMonths)])
for (z in 1:length(model_fin)) {
model1 = unlist(model_fin[z])
Factor1 = t(Factor_all_in[c(model1),,drop=FALSE])
Factor1_out = t(Factor_all_out[c(model1),,drop=FALSE])
muA = colMeans(Factor1)
WA = cov(Factor1)
SR2_in = t(muA)%*%solve(WA)%*%muA
muA_out = colMeans(Factor1_out)
WA_out = cov(Factor1_out)
SR2_out = (t(muA_out)%*%solve(WA)%*%muA)^2 / (t(muA)%*%solve(WA)%*%WA_out%*%solve(WA)%*%muA)
model_SR_in[m,z] = SR2_in
model_SR_out[m,z] = SR2_out
}
}
model_SR_probability_in = model_SR_probability_out =  matrix(,length(model_fin),length(model_fin)+2)
rownames(model_SR_probability_in) = rownames(model_SR_probability_out) = model_all_names
colnames(model_SR_probability_in) = colnames(model_SR_probability_out) = c('M-SR2',model_all_names,'Best')
model_SR_probability_in[,1] = round(colMeans(model_SR_in),2)
model_SR_probability_out[,1] = round(colMeans(model_SR_out),2)
for (i in 1:length(model_fin)) {
for (j in 1:length(model_fin)) {
model_SR_probability_in[i,j+1] = mean(model_SR_in[,i] >model_SR_in[,j])*100
model_SR_probability_out[i,j+1] = mean(model_SR_out[,i] >model_SR_out[,j])*100
}
}
max_prob_matrix_in <- matrix(0, M, length(model_fin))
for (i in 1:M) {
max_prob_matrix_in[i, ] <- as.numeric(model_SR_in[i, ] == max(model_SR_in[i, ]))
}
model_SR_probability_in[,length(model_fin)+2] <- colMeans(max_prob_matrix_in)*100
### out
max_prob_matrix_out <- matrix(0, M, length(model_fin))
for (i in 1:M) {
max_prob_matrix_out[i, ] <- as.numeric(model_SR_out[i, ] == max(model_SR_out[i, ]))
}
model_SR_probability_out[,length(model_fin)+2] <- colMeans(max_prob_matrix_out)*100
model_SR_probability_in_out = rbind(model_SR_probability_in, model_SR_probability_out)
write.csv(model_SR_probability_in_out,'Table10/Table10.csv')
folder_name = "Table11/"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
source('../fun_Section.R')
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
Fama285 = read.csv('../data/Fama285.csv')
Fama285 = as.matrix(Fama285[,-c(1,2)])
Factor_des = read.csv('../data/Factor_des.csv')
# print(c)
names97_cost = names97
Factor97_net = Factor97_gross
for (i in 1:nrow(Factor97_gross)) {
cost_label = Factor_des[i,3]
if (cost_label == 1){ ## annually
Factor97_net[i,] = Factor97_gross[i,] - cost_annually[c]
names97_cost[i] = paste('underline{',names97[i],'}',sep = '')
}
if (cost_label == 3){ ## monthly
Factor97_net[i,] = Factor97_gross[i,] - cost_monthly[c]
}
}
cost_annually = c(0.0002,0.0002)
cost_monthly = c(0.0012,0.0024)
cost_name = c('12bps','24bps')
Factor97_gross = Factor97
model_fin_BSE =  list()
for (c in 1:length(cost_annually)) {
names97_cost = names97
Factor97_net = Factor97_gross
for (i in 1:nrow(Factor97_gross)) {
cost_label = Factor_des[i,3]
if (cost_label == 1){ ## annually
Factor97_net[i,] = Factor97_gross[i,] - cost_annually[c]
names97_cost[i] = paste('underline{',names97[i],'}',sep = '')
}
if (cost_label == 3){ ## monthly
Factor97_net[i,] = Factor97_gross[i,] - cost_monthly[c]
}
}
S_FF5 = c("MKT","SMB","HML","RMW","CMA" )
S_Q5 = c("MKT","SMB","IA", "ROE" , "REG" )
model_fin = list(S_FF5,S_Q5)
for (m in 1:length(model_fin)) {
bench_factor = unlist(model_fin[m])
S_FSE = FSE_stage_bench(Factor97_net, lambda = 0.05,bench_factor)
S_BSE = BSE_stage_bench(Factor97_net, lambda = 0.05,S_FSE)
BSE_index = NULL
for (i in 1:length(S_BSE)) {
BSE_index = c(BSE_index, which(names97 == S_BSE[i]))
}
model_fin_BSE[[m+2*(c-1)]] = names97_cost[c(BSE_index)]
}
}
S_M8 =  c('MKT','REG','PEAD','HMLM','STR','ILR','SMB','EPRD')
S_M8_index = NULL
for (i in 1:length(S_M8)) {
S_M8_index = c(S_M8_index, which(names97 == S_M8[i]))
}
S_M8_BSE = names97_cost[c(S_M8_index)]
S_M8_BSE
merged_list <- c(list(S_M8_BSE),  model_fin_BSE)
max_length <- max(lengths(merged_list))
model_fin_all <- do.call(cbind, lapply(merged_list, function(x) c(x, rep(NA, max_length - length(x)))))
colnames(model_fin_all) =  c('M8','FF5$^{F+B}$', 'Q5$^{F+B}$',
'FF5$^{F+B}$', 'Q5$^{F+B}$')
write.csv(model_fin_all,'Table11/Table11.csv')
