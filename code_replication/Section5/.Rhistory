#### R2
calc_total_R2 = function(factor_LHS_in, factor_RHS_in, factor_RHS_out){
Ts = nrow(factor_LHS_in)
ones = matrix(1,Ts,1)
full_factor_RHS = cbind(ones,t(factor_RHS_in))
alpha_beta = solve(t(full_factor_RHS)%*%full_factor_RHS)%*%t(full_factor_RHS)%*%factor_LHS_in
beta = alpha_beta[-1,, drop = FALSE]
Xhat = t(factor_RHS_out)%*%beta
return(list(Xhat,beta))
}
S_CAPM = c("MKT" )
factor_CAPM_in = factor_all_in[c(S_CAPM),, drop = FALSE]
factor_CAPM_out = factor_all_out[c(S_CAPM),, drop = FALSE]
total_R2_MKT = calc_total_R2(factor_LHS_in, factor_CAPM_in,factor_CAPM_out)
Xhat_MKT = total_R2_MKT[[1]]
beta_MKT = total_R2_MKT[[2]]
total_R2_S = calc_total_R2(factor_LHS_in, factor_RHS_in,factor_RHS_out)
Xhat_S = total_R2_S[[1]]
beta_S = total_R2_S[[2]]
Total_R2 = 1 - sum((factor_LHS_out - Xhat_S)^2) / sum((factor_LHS_out - Xhat_MKT )^2)
Total_R2 = Total_R2*100
calc_CS_R2 = function(factor_LHS_out, beta){
bar_X2 = colMeans(factor_LHS_out)
b = cbind(rep(1,ncol(beta)),t(beta))
gamma = solve(t(b)%*%b)%*%t(b)%*%bar_X2
bar_hat = t(beta) %*%gamma[-1]
return(bar_hat)
}
bar_hat_MKT = calc_CS_R2(factor_LHS_out, beta_MKT)
bar_hat_S = calc_CS_R2(factor_LHS_out, beta_S)
bar_factor_LHS = as.matrix(colMeans(factor_LHS_out))
CS_R2 = 1 - sum((bar_factor_LHS - bar_hat_S)^2) / sum((bar_factor_LHS - bar_hat_MKT)^2)
CS_R2 = CS_R2*100
return(
c(round(Total_R2,1),round(CS_R2,1))
)
}
AP_result_remaining_in = R2_all_factor(Factor97_in, model_fin_all)
AP_result_remaining_in = AP_result_remaining_in[,c(4,5)]
AP_result_remaining_out = R2_all_factor_out(Factor97_in, Factor97_out, model_fin_all)
R2_all_factor_out = function(factor_all_in, factor_all_out,model_fin){
AP_perform_metric_result = matrix(,ncol(model_fin),2)
for (z in 1:ncol(model_fin)) {
S_factor = na.omit(model_fin[,z])
AP_perform_metric_result[z,] = c(AP_perform_metric_out(factor_all_in,factor_all_out,S_factor))
}
return(AP_perform_metric_result)
}
AP_result_remaining_out = R2_all_factor_out(Factor97_in, Factor97_out, model_fin_all)
AP_result_remaining_out
### Asset Pricing (285 basis portfolios)
AP_result_test_asset_in = R2_all_test_asset(Factor97_in, Fama285_in, model_fin_all)
AP_result_test_asset_in = AP_result_test_asset_in[,c(4,5)]
AP_result_test_asset_in
R2_all_factor_out = function(factor_all_in, factor_all_out,model_fin){
AP_perform_metric_result = matrix(,ncol(model_fin),2)
for (z in 1:ncol(model_fin)) {
S_factor = na.omit(model_fin[,z])
AP_perform_metric_result[z,] = c(AP_perform_metric_out(factor_all_in,factor_all_out,test_asset_in = NULL, test_asset_out=NULL,S_factor))
}
return(AP_perform_metric_result)
}
AP_perform_metric_out = function(factor_all_in, factor_all_out,test_asset_in, test_asset_out,S_factor){
factor_RHS_in = factor_all_in[c(S_factor),, drop = FALSE]
factor_RHS_out = factor_all_out[c(S_factor),, drop = FALSE]
if (is.null(test_asset_in)){
factor_LHS_in = factor_all_in[!rownames(factor_all_in) %in% c(S_factor),, drop = FALSE]
factor_LHS_in = t(factor_LHS_in)
} else {
factor_LHS_in = test_asset_in
}
if (is.null(test_asset_out)){
factor_LHS_out = factor_all_out[!rownames(factor_all_out) %in% c(S_factor),, drop = FALSE]
factor_LHS_out = t(factor_LHS_out)
} else {
factor_LHS_out = test_asset_out
}
#### R2
calc_total_R2 = function(factor_LHS_in, factor_RHS_in, factor_RHS_out){
Ts = nrow(factor_LHS_in)
ones = matrix(1,Ts,1)
full_factor_RHS = cbind(ones,t(factor_RHS_in))
alpha_beta = solve(t(full_factor_RHS)%*%full_factor_RHS)%*%t(full_factor_RHS)%*%factor_LHS_in
beta = alpha_beta[-1,, drop = FALSE]
Xhat = t(factor_RHS_out)%*%beta
return(list(Xhat,beta))
}
S_CAPM = c("MKT" )
factor_CAPM_in = factor_all_in[c(S_CAPM),, drop = FALSE]
factor_CAPM_out = factor_all_out[c(S_CAPM),, drop = FALSE]
total_R2_MKT = calc_total_R2(factor_LHS_in, factor_CAPM_in,factor_CAPM_out)
Xhat_MKT = total_R2_MKT[[1]]
beta_MKT = total_R2_MKT[[2]]
total_R2_S = calc_total_R2(factor_LHS_in, factor_RHS_in,factor_RHS_out)
Xhat_S = total_R2_S[[1]]
beta_S = total_R2_S[[2]]
Total_R2 = 1 - sum((factor_LHS_out - Xhat_S)^2) / sum((factor_LHS_out - Xhat_MKT )^2)
Total_R2 = Total_R2*100
calc_CS_R2 = function(factor_LHS_out, beta){
bar_X2 = colMeans(factor_LHS_out)
b = cbind(rep(1,ncol(beta)),t(beta))
gamma = solve(t(b)%*%b)%*%t(b)%*%bar_X2
bar_hat = t(beta) %*%gamma[-1]
return(bar_hat)
}
bar_hat_MKT = calc_CS_R2(factor_LHS_out, beta_MKT)
bar_hat_S = calc_CS_R2(factor_LHS_out, beta_S)
bar_factor_LHS = as.matrix(colMeans(factor_LHS_out))
CS_R2 = 1 - sum((bar_factor_LHS - bar_hat_S)^2) / sum((bar_factor_LHS - bar_hat_MKT)^2)
CS_R2 = CS_R2*100
return(
c(round(Total_R2,1),round(CS_R2,1))
)
}
AP_result_remaining_in = R2_all_factor(Factor97_in, model_fin_all)
AP_result_remaining_in = AP_result_remaining_in[,c(4,5)]
AP_result_remaining_out = R2_all_factor_out(Factor97_in, Factor97_out, model_fin_all)
### Asset Pricing (285 basis portfolios)
AP_result_test_asset_in = R2_all_test_asset(Factor97_in, Fama285_in, model_fin_all)
AP_result_test_asset_in = AP_result_test_asset_in[,c(4,5)]
AP_result_test_asset_out = R2_all_test_asset_out(Factor97_in,Factor97_out, Fama285_in,Fama285_out, model_fin_all)
R2_all_test_asset_out = function(factor_all_in, factor_all_out, test_asset_in,test_asset_out,model_fin){
AP_perform_metric_result = matrix(,ncol(model_fin),2)
for (z in 1:ncol(model_fin)) {
S_factor = na.omit(model_fin[,z])
AP_perform_metric_result[z,] = AP_perform_metric_out(factor_all_in, factor_all_out,test_asset_in, test_asset_out,S_factor)
}
return(AP_perform_metric_result)
}
AP_result_test_asset_out = R2_all_test_asset_out(Factor97_in,Factor97_out, Fama285_in,Fama285_out, model_fin_all)
AP_result_test_asset_out
##### Investment performance
invest_result_in = investing_asset(Factor97_in,model_fin_all)
invest_result_in
##### Investment performance
invest_result_in = investing_asset(Factor97_in,model_fin_all)
invest_result_in = invest_result_in[,2]
invest_result_out = investing_asset_out(Factor97_in,Factor97_out,model_fin_all)
invest_result_out
invest_perform_metric_out = function(factor_all_in,factor_all_out,S_factor){
factor_RHS_in = factor_all_in[c(S_factor),, drop = FALSE]
factor_RHS_out = factor_all_out[c(S_factor),, drop = FALSE]
if (length(S_factor) == 1){
factor_MVE = factor_RHS_out
} else {
W_S_factor = cov(t(factor_RHS_in))
W_S_factor_inv = solve(W_S_factor)
mu_S_factor = matrix(rowMeans(factor_RHS_in), ncol = 1)
weight_MVE = W_S_factor_inv %*% mu_S_factor
weight_MVE_adj =  2 * weight_MVE/sum(abs(weight_MVE))
factor_MVE = t(weight_MVE_adj)%*%factor_RHS_out
}
SR = mean(factor_MVE)/sd(factor_MVE)
Ann_SR = sqrt(12)*SR
Ann_SR = round(Ann_SR,2)
return(Ann_SR)
}
invest_result_out = investing_asset_out(Factor97_in,Factor97_out,model_fin_all)
invest_result_out
investing_asset_out = function(factor_all_in,factor_all_out,model_fin){
invest_metric_result = matrix(, ncol(model_fin), 1)
for (z in 1:ncol(model_fin)) {
S_factor = na.omit(model_fin[,z])
invest_metric_result[z,] = invest_perform_metric_out(factor_all_in,factor_all_out,S_factor)
}
#
return(invest_metric_result)
}
invest_result_out = investing_asset_out(Factor97_in,Factor97_out,model_fin_all)
invest_result_out
invest_result_in
result_all_in = cbind(AP_result_remaining_in,AP_result_test_asset_in,invest_result_in)
result_all_in
result_all_out = cbind(AP_result_remaining_out,AP_result_test_asset_out,invest_result_out)
result_all_out
result_all_in_out = rbind(result_all_in, result_all_out)
invest_result_out
invest_result_in
source('../fun_Section.R')
folder_name <- "Table5/"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
Fama285 = read.csv('../data/Fama285.csv')
Fama285 = as.matrix(Fama285[,-c(1,2)])
S_FF5 = c("MKT","SMB","HML","RMW","CMA" )
S_Q5 = c("MKT","SMB","IA", "ROE" , "REG" )
S_M8 =  c('MKT','SMB','REG','PEAD','HMLM','STR','ILR','EPRD')
model_fin = list(S_FF5,S_Q5)
Ts = nrow(Fama285)
L = Ts / 3
times_name = c('Time1','Time2','Time3')
for (z in 1:3) {
Factor97_in = Factor97[,-c((L*(z-1)+1):(L*z))]
Fama285_in = Fama285[-c((L*(z-1)+1):(L*z)),]
Factor97_out = Factor97[,(L*(z-1)+1):(L*z)]
Fama285_out = Fama285[(L*(z-1)+1):(L*z),]
model_fin_BSE =  list()
for (m in 1:length(model_fin)) {
# print(m)
m1 = unlist(model_fin[m])
bench_factor = m1
S_FSE = FSE_stage_bench(Factor97_in, lambda = 0.05,bench_factor)
bench_factor_BSE = S_FSE
S_BSE =  BSE_stage_bench(Factor97_in, lambda = 0.05,bench_factor_BSE)
model_fin_BSE[[m]] = S_BSE
}
merged_list <- c(model_fin,  model_fin_BSE, list(S_M8))
max_length <- max(lengths(merged_list))
model_fin_all <- do.call(cbind, lapply(merged_list, function(x) c(x, rep(NA, max_length - length(x)))))
colnames(model_fin_all) =  c('FF5', 'Q5', 'FF5$^{F+B}$', 'Q5$^{F+B}$','M8')
### Asset Pricing (unselected candidate factors)
AP_result_remaining_in = R2_all_factor(Factor97_in, model_fin_all)
AP_result_remaining_in = AP_result_remaining_in[,c(4,5)]
AP_result_remaining_out = R2_all_factor_out(Factor97_in, Factor97_out, model_fin_all)
### Asset Pricing (285 basis portfolios)
AP_result_test_asset_in = R2_all_test_asset(Factor97_in, Fama285_in, model_fin_all)
AP_result_test_asset_in = AP_result_test_asset_in[,c(4,5)]
AP_result_test_asset_out = R2_all_test_asset_out(Factor97_in,Factor97_out, Fama285_in,Fama285_out, model_fin_all)
##### Investment performance
invest_result_in = investing_asset(Factor97_in,model_fin_all)
invest_result_in = invest_result_in[,2]
invest_result_out = investing_asset_out(Factor97_in,Factor97_out,model_fin_all)
# invest_result_out = invest_result_out[,2]
result_all_in = cbind(AP_result_remaining_in,AP_result_test_asset_in,invest_result_in)
result_all_out = cbind(AP_result_remaining_out,AP_result_test_asset_out,invest_result_out)
result_all_in_out = rbind(result_all_in, result_all_out)
colnames(result_all_in_out) = c('Total_R2','CS_R2','Total_R2','CS_R2',"Ann.SR")
rownames(result_all_in_out) = c(
'FF5','Q5', 'FF5$^{F+B}$', 'Q5$^{F+B}$', 'M8', 'FF5','Q5', 'FF5$^{F+B}$', 'Q5$^{F+B}$', 'M8')
file1_in = paste('Table5/Table5_performance_in_out_sample_', times_name[[z]],'.csv',sep = '')
write.csv(result_all_in_out,file1_in)
}
source('../fun_Section.R')
folder_name <- "Table5/"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
Fama285 = read.csv('../data/Fama285.csv')
Fama285 = as.matrix(Fama285[,-c(1,2)])
S_FF5 = c("MKT","SMB","HML","RMW","CMA" )
S_Q5 = c("MKT","SMB","IA", "ROE" , "REG" )
S_M8 =  c('MKT','SMB','REG','PEAD','HMLM','STR','ILR','EPRD')
model_fin = list(S_FF5,S_Q5)
Ts = nrow(Fama285)
L = Ts / 3
times_name = c('Time1','Time2','Time3')
for (z in 1:3) {
Factor97_in = Factor97[,-c((L*(z-1)+1):(L*z))]
Fama285_in = Fama285[-c((L*(z-1)+1):(L*z)),]
Factor97_out = Factor97[,(L*(z-1)+1):(L*z)]
Fama285_out = Fama285[(L*(z-1)+1):(L*z),]
model_fin_BSE =  list()
for (m in 1:length(model_fin)) {
# print(m)
m1 = unlist(model_fin[m])
bench_factor = m1
S_FSE = FSE_stage_bench(Factor97_in, lambda = 0.05,bench_factor)
bench_factor_BSE = S_FSE
S_BSE =  BSE_stage_bench(Factor97_in, lambda = 0.05,bench_factor_BSE)
model_fin_BSE[[m]] = S_BSE
}
merged_list <- c(model_fin,  model_fin_BSE, list(S_M8))
max_length <- max(lengths(merged_list))
model_fin_all <- do.call(cbind, lapply(merged_list, function(x) c(x, rep(NA, max_length - length(x)))))
colnames(model_fin_all) =  c('FF5', 'Q5', 'FF5$^{F+B}$', 'Q5$^{F+B}$','M8')
### Asset Pricing (unselected candidate factors)
AP_result_remaining_in = R2_all_factor(Factor97_in, model_fin_all)
AP_result_remaining_in = AP_result_remaining_in[,c(4,5)]
AP_result_remaining_out = R2_all_factor_out(Factor97_in, Factor97_out, model_fin_all)
### Asset Pricing (285 basis portfolios)
AP_result_test_asset_in = R2_all_test_asset(Factor97_in, Fama285_in, model_fin_all)
AP_result_test_asset_in = AP_result_test_asset_in[,c(4,5)]
AP_result_test_asset_out = R2_all_test_asset_out(Factor97_in,Factor97_out, Fama285_in,Fama285_out, model_fin_all)
##### Investment performance
invest_result_in = investing_asset(Factor97_in,model_fin_all)
invest_result_in = invest_result_in[,2]
invest_result_out = investing_asset_out(Factor97_in,Factor97_out,model_fin_all)
# invest_result_out = invest_result_out[,2]
result_all_in = cbind(AP_result_remaining_in,AP_result_test_asset_in,invest_result_in)
result_all_out = cbind(AP_result_remaining_out,AP_result_test_asset_out,invest_result_out)
result_all_in_out = rbind(result_all_in, result_all_out)
colnames(result_all_in_out) = c('Total_R2','CS_R2','Total_R2','CS_R2',"Ann.SR")
rownames(result_all_in_out) = c(
'FF5','Q5', 'FF5$^{F+B}$', 'Q5$^{F+B}$', 'M8', 'FF5','Q5', 'FF5$^{F+B}$', 'Q5$^{F+B}$', 'M8')
file1_in = paste('Table5/Table5_performance_in_out_sample_', times_name[[z]],'.csv',sep = '')
write.csv(result_all_in_out,file1_in)
}
AP_result_remaining_in
AP_result_remaining_in = R2_all_factor(Factor97_in, model_fin_all)
AP_result_remaining_in
source('../fun_Section.R')
folder_name <- "Table5/"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
Fama285 = read.csv('../data/Fama285.csv')
Fama285 = as.matrix(Fama285[,-c(1,2)])
S_FF5 = c("MKT","SMB","HML","RMW","CMA" )
S_Q5 = c("MKT","SMB","IA", "ROE" , "REG" )
S_M8 =  c('MKT','SMB','REG','PEAD','HMLM','STR','ILR','EPRD')
model_fin = list(S_FF5,S_Q5)
Ts = nrow(Fama285)
L = Ts / 3
times_name = c('Time1','Time2','Time3')
for (z in 1:3) {
Factor97_in = Factor97[,-c((L*(z-1)+1):(L*z))]
Fama285_in = Fama285[-c((L*(z-1)+1):(L*z)),]
Factor97_out = Factor97[,(L*(z-1)+1):(L*z)]
Fama285_out = Fama285[(L*(z-1)+1):(L*z),]
model_fin_BSE =  list()
for (m in 1:length(model_fin)) {
# print(m)
m1 = unlist(model_fin[m])
bench_factor = m1
S_FSE = FSE_stage_bench(Factor97_in, lambda = 0.05,bench_factor)
bench_factor_BSE = S_FSE
S_BSE =  BSE_stage_bench(Factor97_in, lambda = 0.05,bench_factor_BSE)
model_fin_BSE[[m]] = S_BSE
}
merged_list <- c(model_fin,  model_fin_BSE, list(S_M8))
max_length <- max(lengths(merged_list))
model_fin_all <- do.call(cbind, lapply(merged_list, function(x) c(x, rep(NA, max_length - length(x)))))
colnames(model_fin_all) =  c('FF5', 'Q5', 'FF5$^{F+B}$', 'Q5$^{F+B}$','M8')
### Asset Pricing (unselected candidate factors)
AP_result_remaining_in = R2_all_factor(Factor97_in, model_fin_all)
AP_result_remaining_in = AP_result_remaining_in[,c(5,6)]
AP_result_remaining_out = R2_all_factor_out(Factor97_in, Factor97_out, model_fin_all)
### Asset Pricing (285 basis portfolios)
AP_result_test_asset_in = R2_all_test_asset(Factor97_in, Fama285_in, model_fin_all)
AP_result_test_asset_in = AP_result_test_asset_in[,c(5,6)]
AP_result_test_asset_out = R2_all_test_asset_out(Factor97_in,Factor97_out, Fama285_in,Fama285_out, model_fin_all)
##### Investment performance
invest_result_in = investing_asset(Factor97_in,model_fin_all)
invest_result_in = invest_result_in[,2]
invest_result_out = investing_asset_out(Factor97_in,Factor97_out,model_fin_all)
# invest_result_out = invest_result_out[,2]
result_all_in = cbind(AP_result_remaining_in,AP_result_test_asset_in,invest_result_in)
result_all_out = cbind(AP_result_remaining_out,AP_result_test_asset_out,invest_result_out)
result_all_in_out = rbind(result_all_in, result_all_out)
colnames(result_all_in_out) = c('Total_R2','CS_R2','Total_R2','CS_R2',"Ann.SR")
rownames(result_all_in_out) = c(
'FF5','Q5', 'FF5$^{F+B}$', 'Q5$^{F+B}$', 'M8', 'FF5','Q5', 'FF5$^{F+B}$', 'Q5$^{F+B}$', 'M8')
file1_in = paste('Table5/Table5_performance_in_out_sample_', times_name[[z]],'.csv',sep = '')
write.csv(result_all_in_out,file1_in)
}
AP_result_test_asset_in
source('../fun_Section.R')
folder_name <- "Table5/"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
Fama285 = read.csv('../data/Fama285.csv')
Fama285 = as.matrix(Fama285[,-c(1,2)])
S_FF5 = c("MKT","SMB","HML","RMW","CMA" )
S_Q5 = c("MKT","SMB","IA", "ROE" , "REG" )
S_M8 =  c('MKT','SMB','REG','PEAD','HMLM','STR','ILR','EPRD')
model_fin = list(S_FF5,S_Q5)
Ts = nrow(Fama285)
L = Ts / 3
times_name = c('Time1','Time2','Time3')
for (z in 1:3) {
Factor97_in = Factor97[,-c((L*(z-1)+1):(L*z))]
Fama285_in = Fama285[-c((L*(z-1)+1):(L*z)),]
Factor97_out = Factor97[,(L*(z-1)+1):(L*z)]
Fama285_out = Fama285[(L*(z-1)+1):(L*z),]
model_fin_BSE =  list()
for (m in 1:length(model_fin)) {
# print(m)
m1 = unlist(model_fin[m])
bench_factor = m1
S_FSE = FSE_stage_bench(Factor97_in, lambda = 0.05,bench_factor)
bench_factor_BSE = S_FSE
S_BSE =  BSE_stage_bench(Factor97_in, lambda = 0.05,bench_factor_BSE)
model_fin_BSE[[m]] = S_BSE
}
merged_list <- c(model_fin,  model_fin_BSE, list(S_M8))
max_length <- max(lengths(merged_list))
model_fin_all <- do.call(cbind, lapply(merged_list, function(x) c(x, rep(NA, max_length - length(x)))))
colnames(model_fin_all) =  c('FF5', 'Q5', 'FF5$^{F+B}$', 'Q5$^{F+B}$','M8')
### Asset Pricing (unselected candidate factors)
AP_result_remaining_in = R2_all_factor(Factor97_in, model_fin_all)
AP_result_remaining_in = AP_result_remaining_in[,c(5,6)]
AP_result_remaining_out = R2_all_factor_out(Factor97_in, Factor97_out, model_fin_all)
### Asset Pricing (285 basis portfolios)
AP_result_test_asset_in = R2_all_test_asset(Factor97_in, Fama285_in, model_fin_all)
AP_result_test_asset_in = AP_result_test_asset_in[,c(4,5)]
AP_result_test_asset_out = R2_all_test_asset_out(Factor97_in,Factor97_out, Fama285_in,Fama285_out, model_fin_all)
##### Investment performance
invest_result_in = investing_asset(Factor97_in,model_fin_all)
invest_result_in = invest_result_in[,2]
invest_result_out = investing_asset_out(Factor97_in,Factor97_out,model_fin_all)
# invest_result_out = invest_result_out[,2]
result_all_in = cbind(AP_result_remaining_in,AP_result_test_asset_in,invest_result_in)
result_all_out = cbind(AP_result_remaining_out,AP_result_test_asset_out,invest_result_out)
result_all_in_out = rbind(result_all_in, result_all_out)
colnames(result_all_in_out) = c('Total_R2','CS_R2','Total_R2','CS_R2',"Ann.SR")
rownames(result_all_in_out) = c(
'FF5','Q5', 'FF5$^{F+B}$', 'Q5$^{F+B}$', 'M8', 'FF5','Q5', 'FF5$^{F+B}$', 'Q5$^{F+B}$', 'M8')
file1_in = paste('Table5/Table5_performance_in_out_sample_', times_name[[z]],'.csv',sep = '')
write.csv(result_all_in_out,file1_in)
}
file1_in = paste('Table5/Table5_performance_in_out', '.csv',sep = '')
file1_in
result_all_in_out = matrix(,10,15)
z
AP_result_remaining_in
2*(z-1)+1
result_all_in_out[1:5,c(2*(z-1)+1, 2*(z-1)+2)] = AP_result_remaining_in
result_all_in_out[1:5,c(2*(z-1)+7, 2*(z-1)+8)] = AP_result_test_asset_in
source('../fun_Section.R')
folder_name <- "Table5/"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
Fama285 = read.csv('../data/Fama285.csv')
Fama285 = as.matrix(Fama285[,-c(1,2)])
S_FF5 = c("MKT","SMB","HML","RMW","CMA" )
S_Q5 = c("MKT","SMB","IA", "ROE" , "REG" )
S_M8 =  c('MKT','SMB','REG','PEAD','HMLM','STR','ILR','EPRD')
model_fin = list(S_FF5,S_Q5)
Ts = nrow(Fama285)
L = Ts / 3
times_name = c('Time1','Time2','Time3')
result_all_in_out = matrix(,10,15)
for (z in 1:3) {
Factor97_in = Factor97[,-c((L*(z-1)+1):(L*z))]
Fama285_in = Fama285[-c((L*(z-1)+1):(L*z)),]
Factor97_out = Factor97[,(L*(z-1)+1):(L*z)]
Fama285_out = Fama285[(L*(z-1)+1):(L*z),]
model_fin_BSE =  list()
for (m in 1:length(model_fin)) {
# print(m)
m1 = unlist(model_fin[m])
bench_factor = m1
S_FSE = FSE_stage_bench(Factor97_in, lambda = 0.05,bench_factor)
bench_factor_BSE = S_FSE
S_BSE =  BSE_stage_bench(Factor97_in, lambda = 0.05,bench_factor_BSE)
model_fin_BSE[[m]] = S_BSE
}
merged_list <- c(model_fin,  model_fin_BSE, list(S_M8))
max_length <- max(lengths(merged_list))
model_fin_all <- do.call(cbind, lapply(merged_list, function(x) c(x, rep(NA, max_length - length(x)))))
colnames(model_fin_all) =  c('FF5', 'Q5', 'FF5$^{F+B}$', 'Q5$^{F+B}$','M8')
### Asset Pricing (unselected candidate factors)
AP_result_remaining_in = R2_all_factor(Factor97_in, model_fin_all)
AP_result_remaining_in = AP_result_remaining_in[,c(5,6)]
AP_result_remaining_out = R2_all_factor_out(Factor97_in, Factor97_out, model_fin_all)
### Asset Pricing (285 basis portfolios)
AP_result_test_asset_in = R2_all_test_asset(Factor97_in, Fama285_in, model_fin_all)
AP_result_test_asset_in = AP_result_test_asset_in[,c(4,5)]
AP_result_test_asset_out = R2_all_test_asset_out(Factor97_in,Factor97_out, Fama285_in,Fama285_out, model_fin_all)
##### Investment performance
invest_result_in = investing_asset(Factor97_in,model_fin_all)
invest_result_in = invest_result_in[,2]
invest_result_out = investing_asset_out(Factor97_in,Factor97_out,model_fin_all)
# invest_result_out = invest_result_out[,2]
#
# result_all_in = cbind(AP_result_remaining_in,AP_result_test_asset_in,invest_result_in)
#
# result_all_out = cbind(AP_result_remaining_out,AP_result_test_asset_out,invest_result_out)
#
# result_all_in_out = rbind(result_all_in, result_all_out)
result_all_in_out[1:5,c(2*(z-1)+1, 2*(z-1)+2)] = AP_result_remaining_in
result_all_in_out[1:5,c(2*(z-1)+7, 2*(z-1)+8)] = AP_result_test_asset_in
result_all_in_out[1:5,c(z+12)] = invest_result_in
result_all_in_out[6:10,c(2*(z-1)+1, 2*(z-1)+2)] = AP_result_remaining_out
result_all_in_out[6:10,c(2*(z-1)+7, 2*(z-1)+8)] = AP_result_test_asset_out
result_all_in_out[6:10,c(z+12)] = invest_result_out
}
colnames(result_all_in_out) = c('Total_R2','CS_R2','Total_R2','CS_R2','Total_R2','CS_R2',
'Total_R2','CS_R2','Total_R2','CS_R2','Total_R2','CS_R2',
"Ann.SR","Ann.SR","Ann.SR")
rownames(result_all_in_out) = c(
'FF5','Q5', 'FF5$^{F+B}$', 'Q5$^{F+B}$', 'M8',
'FF5','Q5', 'FF5$^{F+B}$', 'Q5$^{F+B}$', 'M8')
file1_in = paste('Table5/Table5_performance_in_out', '.csv',sep = '')
write.csv(result_all_in_out,file1_in)
folder_name = "Figure3"
if (!dir.exists(folder_name)) {
dir.create(folder_name)
}
source('../fun_Section.R')
Factor97 = read.csv('../data/Factor97.csv', check.names = FALSE)
Factor97 = as.matrix(t(Factor97[,-c(1,2)]))
names97 = rownames(Factor97)
Fama285 = read.csv('../data/Fama285.csv')
Fama285 = as.matrix(Fama285[,-c(1,2)])
S_CAPM = c("MKT")
S_FF3 = c("MKT","SMB","HML")
S_FF5 = c("MKT","SMB","HML","RMW","CMA" )
S_FF6 = c(S_FF5,'UMD' )
S_Q5 = c("MKT","SMB","IA", "ROE" , "REG" )
S_DHS3 = c('MKT', "PEAD", "FIN")
S_BS6 =  c("MKT","SMB","IA", "ROE" , 'UMD',"HMLM" )
model_fin_all = read.csv('../Section4/Table1/Model_fin_all.csv')
model_fin_all = model_fin_all[,-1]
